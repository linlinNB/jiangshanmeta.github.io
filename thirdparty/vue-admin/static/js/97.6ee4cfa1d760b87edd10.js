(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{"2gjT":function(t,e,n){"use strict";n.d(e,"a",function(){return l});var i=n("4d7F"),r=n.n(i),o=n("GQeE"),a=n.n(o);function l(t,e){Array.isArray(e)||(e=a()(e).map(function(t){return{name:t,component:e[t]}})),e.forEach(function(e){t.$options.components[e.name]=e.component});var n=e.filter(function(t){var e=t.component;return"function"==typeof e&&!e.cid}).map(function(e){var n=e.component,i=e.name;return n().then(function(e){t.$options.components[i]=e})});return r.a.all(n)}},"3ie/":function(t,e,n){"use strict";n.r(e);var i,r=n("4d7F"),o=n.n(r),a=n("P2sY"),l=n.n(a),s=n("14Xm"),c=n.n(s),u=n("D3Ub"),f=n.n(u),d=n("GQeE"),p=n.n(d),h=n("gDS+"),m=n.n(h),g=n("5VPc"),_=n("Q8dH"),b=n("2gjT"),y={name:"filters",inheritAttrs:!0,mixins:[_.a],components:{filter_enum:function(){return n.e(80).then(n.bind(null,"Q5oh"))},filter_async_enum:function(){return n.e(79).then(n.bind(null,"VOx8"))},filter_model:function(){return n.e(78).then(n.bind(null,"t4/g"))},filter_async_model:function(){return n.e(77).then(n.bind(null,"cxXF"))},filter_relates_enum:function(){return n.e(76).then(n.bind(null,"xNg7"))},filter_relates_model:function(){return n.e(75).then(n.bind(null,"RojC"))},field_enum_select:function(){return n.e(27).then(n.bind(null,"W+A4"))},field_async_enum_select:function(){return n.e(26).then(n.bind(null,"Mhqh"))},field_model:function(){return n.e(25).then(n.bind(null,"olIR"))},field_async_model:function(){return n.e(24).then(n.bind(null,"iGBc"))},field_year:function(){return n.e(23).then(n.bind(null,"pwcs"))},field_month:function(){return n.e(22).then(n.bind(null,"jUS4"))},field_day:function(){return n.e(21).then(n.bind(null,"oLbi"))},field_string:function(){return n.e(11).then(n.bind(null,"NHUl"))},field_number:function(){return n.e(20).then(n.bind(null,"Bufb"))},field_relates_enum_select:function(){return n.e(19).then(n.bind(null,"RGNH"))},field_relates_model:function(){return n.e(18).then(n.bind(null,"Pl27"))},operators:function(){return Promise.resolve().then(n.bind(null,"K/sN"))}},data:function(){return{componentsInjected:!1,filtersValueMap:{}}},props:{filters:{type:Array,required:!0},field_list:{type:Object,required:!0},filterOperators:{type:Array,default:function(){return[]}}},created:function(){this.injectFilterComponents(),this.resetValue(),this.initRelates(),this.initWatch()},computed:{formData:function(){return JSON.parse(m()(this.filtersValueMap))},needInjectFilterComponents:function(){return this.filters.filter(function(t){return t.editorComponent.component}).map(function(t){return t.editorComponent})},hasInjectComponent:function(){return this.needInjectFilterComponents.length}},methods:{search:function(){this.$emit("search")},injectFilterComponents:function(){var t=this;this.hasInjectComponent&&Object(b.a)(this,this.needInjectFilterComponents).then(function(){t.componentsInjected=!0})},resetValue:function(){var t=this;this.filtersValueMap=this.filters.reduce(function(e,n){var i=n.editorComponent.default;return e[n.field]="function"==typeof i?i.call(t):i,e},{})},initRelates:function(){var t=this;this.filters.forEach(function(e){e.editorComponent&&e.editorComponent.config&&e.editorComponent.config.relates&&Object(g.a)(e.editorComponent.config.relates,t.filtersValueMap)})},initWatch:function(){var t=this,e=this.filters.filter(function(t){return t.watch});e.length&&this.$watch(function(){return e.map(function(e){return t.filtersValueMap[e.field]})},this.search)}}},v=(n("dwmJ"),n("KHd+")),j=Object(v.a)(y,function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.filters.length||!t.hasInjectComponent||t.componentsInjected?n("el-form",{directives:[{name:"show",rawName:"v-show",value:t.filters.length,expression:"filters.length"}],staticClass:"filters",attrs:{inline:!0}},[t._l(t.filters,function(e){return n("el-form-item",{key:e.field,attrs:{label:e.label}},[n(e.editorComponent.name,t._b({tag:"component",model:{value:t.filtersValueMap[e.field],callback:function(n){t.$set(t.filtersValueMap,e.field,n)},expression:"filtersValueMap[item.field]"}},"component",t.mergeAttrsConfig(e.editorComponent.config),!1))],1)}),t._v(" "),n("el-form-item",[n("section",[n("el-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:t.search}},[t._v("\n                查询\n            ")]),t._v(" "),n("operators",{staticStyle:{display:"inline-block"},attrs:{field_list:t.field_list,operators:t.filterOperators,data:t.filtersValueMap,filters:t.filters},on:{update:t.search}})],1)])],2):t._e()},[],!1,null,"35c75b3b",null).exports,C=n("K/sN"),I=n("c5sh"),O=n("lhuP"),S={mixins:[_.a],components:{filters:j,operators:C.default,views:I.a},beforeCreate:function(){Object.defineProperty(this,"formData",{get:function(){return this.$refs.filters&&this.$refs.filters.formData}})},created:function(){var t=this;this.localPageSize=this.pageSize,this.needInjectViewComponents=p()(this.field_list).filter(function(e){return t.field_list[e].view&&t.field_list[e].view.component}).map(function(e){return t.field_list[e].view}),this.hasInjectComponent=this.needInjectViewComponents.length>0,this.injectViewComponents(),this.$watch(function(){return{localPageSize:t.localPageSize,sortField:t.sortField,sortOrder:t.sortOrder,pageIndex:t.pageIndex}},this.getListInfo),this.getListInfo()},data:function(){return{componentsInjected:!1,data:[],pageIndex:1,sortField:"",sortOrder:"",total:0,fields:[],multipleSelection:[],operatorMinWidth:0,localPageSize:0}},props:{field_list:{type:Object,required:!0},filters:{type:Array,default:function(){return[]}},filterOperators:{type:Array,default:function(){return[]}},pageSize:{type:Number,default:20},pageIndexReqName:{type:String,default:"pageIndex"},pageSizeReqName:{type:String,default:"pageSize"},sortFieldReqName:{type:String,default:"sortField"},sortOrderReqName:{type:String,default:"sortOrder"},transformRequestData:{type:Function,default:function(t){return t}},listRequest:{type:Function,required:!0},transformListData:{type:Function,default:(i=f()(c.a.mark(function t(e){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e);case 1:case"end":return t.stop()}},t,void 0)})),function(t){return i.apply(this,arguments)})},tableConfig:{type:Object,default:function(){return{}}},selection:{type:Boolean,default:!1},sortFields:{type:Array,default:function(){return[]}},operators:{type:Array,default:function(){return[]}},operatorsLabel:{type:String,default:"操作"},emptyText:{type:String,default:"暂无数据"},paginated:{type:Boolean,default:!0},paginationConfig:{type:Object,default:function(){return{}}}},methods:{injectViewComponents:function(){var t=this;this.hasInjectComponent&&Object(b.a)(this,this.needInjectViewComponents).then(function(){t.componentsInjected=!0})},handleSortChange:function(t){t.prop?(this.sortField=t.prop,this.sortOrder=t.order.startsWith("desc")?"desc":"asc"):(this.sortField="",this.sortOrder=""),this.pageIndex=1},handleSizeChange:function(t){this.localPageSize=t,this.pageIndex=1},handleSelectionChange:function(t){this.multipleSelection=t},getListInfo:function(){var t=this,e={};if(!this.filters.length||this.$refs.filters&&0!==p()(this.$refs.filters.formData).length)return this.filters.length&&(e=l()(e,this.$refs.filters.formData)),this.paginated&&(e[this.pageIndexReqName]=this.pageIndex,e[this.pageSizeReqName]=this.localPageSize<=0?this.pageSize:this.localPageSize),e[this.sortFieldReqName]=this.sortField,e[this.sortOrderReqName]=this.sortOrder,console.log(e),new o.a(function(n,i){t.listRequest(n,t.transformRequestData(e))}).then(function(e){var n=e.data,i=e.total,r=e.fields,a=t.transformListData(n);a instanceof o.a||(a=o.a.resolve(a)),a.then(function(e){t.fields=r,t.total=i,t.data=e})}).catch(O.c);setTimeout(function(){t.getListInfo()},0)},setOperatorWidth:function(t){t>this.operatorMinWidth&&(this.operatorMinWidth=t)}}},w=Object(v.a)(S,function(){var t=this,e=t.$createElement,n=t._self._c||e;return!Object.keys(t.field_list).length||t.hasInjectComponent&&!t.componentsInjected?t._e():n("section",[t._t("beforeFilters",null,{data:t.data,formData:t.formData,selectedData:t.selection?t.multipleSelection:[]}),t._v(" "),n("filters",{ref:"filters",attrs:{filters:t.filters,field_list:t.field_list,filterOperators:t.filterOperators},on:{search:t.getListInfo}}),t._v(" "),t._t("afterFilters",null,{data:t.data,formData:t.formData,selectedData:t.selection?t.multipleSelection:[]}),t._v(" "),t.fields.length&&t.data.length?n("el-table",t._b({staticStyle:{width:"100%"},attrs:{data:t.data},on:{"sort-change":t.handleSortChange,"selection-change":t.handleSelectionChange}},"el-table",t.tableConfig,!1),[t.selection?n("el-table-column",{attrs:{type:"selection"}}):t._e(),t._v(" "),t._l(t.fields,function(e){return t.field_list[e]?n("el-table-column",t._b({key:e,attrs:{label:t.field_list[e].label,prop:e,sortable:!!t.sortFields.includes(e)&&"custom"},scopedSlots:t._u([{key:"default",fn:function(i){return[n("views",{attrs:{descriptor:t.field_list[e],record:i.row,field:e},scopedSlots:t._u([{key:"default",fn:function(i){return t.field_list[e].view&&t.field_list[e].view.component?[n(t.field_list[e].view.name,t._b({tag:"component"},"component",i,!1))]:void 0}}])})]}}])},"el-table-column",t.field_list[e].tableColumnConfig||{},!1)):t._e()}),t._v(" "),t.operators.length&&t.data.length?n("el-table-column",{attrs:{label:t.operatorsLabel,"min-width":t.operatorMinWidth},scopedSlots:t._u([{key:"default",fn:function(e){return[n("operators",{attrs:{field_list:t.field_list,operators:t.operators,data:e.row,index:e.$index},on:{update:t.getListInfo,setWidth:t.setOperatorWidth}})]}}])}):t._e()],2):t._e(),t._v(" "),0===t.data.length?n("section",{staticStyle:{margin:"10px","text-align":"center","font-size":"28px",color:"#777","letter-spacing":"8px"}},[t._v("\n        "+t._s(t.emptyText)+"\n    ")]):t._e(),t._v(" "),t.paginated&&t.data.length?n("el-pagination",t._b({staticStyle:{display:"table","margin-left":"auto","margin-right":"auto"},attrs:{"current-page":t.pageIndex,"page-size":t.localPageSize,total:t.total},on:{"size-change":t.handleSizeChange,"update:currentPage":function(e){t.pageIndex=e}}},"el-pagination",t.paginationConfig,!1)):t._e()],2)},[],!1,null,null,null);e.default=w.exports},"5VPc":function(t,e,n){"use strict";n.d(e,"a",function(){return o});var i=n("EJiy"),r=n.n(i);function o(t,e){t.forEach(function(t){t.relateField&&"object"!==r()(t.relateField)&&function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.relateField;Object.defineProperty(t,"value",{get:function(){return e[n]},set:function(){},enumerable:!0,configurable:!0})}(t,e)})}},D0z4:function(t,e,n){},"K/sN":function(t,e,n){"use strict";n.r(e);var i=n("4d7F"),r=n.n(i),o=n("Q8dH"),a=n("2gjT"),l=n("lhuP"),s={name:"operators",inheritAttrs:!0,mixins:[o.a],props:{operators:{type:Array,default:function(){return[]}},data:{type:[Object,Array],required:!0}},data:function(){return{componentsInjected:!1}},computed:{needInjectOperatorComponents:function(){return this.operators.filter(function(t){return t.component})},hasInjectComponent:function(){return this.needInjectOperatorComponents.length}},methods:{injectOperatorComponents:function(){var t=this;this.hasInjectComponent?Object(a.a)(this,this.needInjectOperatorComponents).then(function(){t.componentsInjected=!0,t.notifytWidth()}):this.notifytWidth()},handleOperatorClick:function(t){var e=this;new r.a(function(n,i){t.call(e,n,e.data)}).then(function(){e.notifyUpdate()}).catch(l.c)},notifyUpdate:function(){this.$emit("update")},notifytWidth:function(){var t=this;this.$nextTick(function(){t.$emit("setWidth",t.$refs.container.scrollWidth)})}},created:function(){this.injectOperatorComponents()}},c=(n("WRMN"),n("KHd+")),u=Object(c.a)(s,function(){var t=this,e=t.$createElement,n=t._self._c||e;return!t.hasInjectComponent||t.componentsInjected?n("div",{ref:"container",staticClass:"operator-container"},[t._l(t.operators,function(e){return[e.component?n(e.name,t._b({tag:"component",attrs:{data:t.data},on:{update:t.notifyUpdate}},"component",t.mergeAttrsConfig(e.config),!1)):e.handler?n("el-button",t._b({on:{click:function(n){t.handleOperatorClick(e.handler)}}},"el-button",e.triggerConfig||{},!1),[t._v("\n            "+t._s(e.triggerConfig&&e.triggerConfig.text||e.label)+"\n        ")]):t._e()]})],2):t._e()},[],!1,null,"c867baf6",null);e.default=u.exports},MEGF:function(t,e,n){},Q8dH:function(t,e,n){"use strict";var i=n("P2sY"),r=n.n(i),o=n("m1cH"),a=n.n(o),l=n("EJiy"),s=n.n(l);e.a={methods:{mergeAttrsConfig:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e=e.filter(function(t){return t&&"object"===(void 0===t?"undefined":s()(t))}),r.a.apply(Object,[{},this.$attrs].concat(a()(e)))}}}},WRMN:function(t,e,n){"use strict";var i=n("D0z4");n.n(i).a},c5sh:function(t,e,n){"use strict";var i=n("QbLZ"),r=n.n(i),o=n("GQeE"),a=n.n(o),l=n("YEIV"),s=n.n(l),c=n("EJiy"),u=n.n(c);e.a={functional:!0,render:function(t,e){var n=e.props,i=e.data,o=n.record[n.field];if(!n.descriptor.view)return t("span",[o]);var l=n.descriptor.view,c=l.config,f=void 0===c?{}:c,d=l.join,p=l.component,h=l.handler,m=!1;if("object"===(void 0===d?"undefined":u()(d))){m=!0;var g=n.record.hasOwnProperty(n.field)?s()({},n.field,o):{};o=Array.isArray(d)?d.reduce(function(t,e){return t[e]=n.record[e],t},g):a()(d).reduce(function(t,e){return t[d[e]]=n.record[e],t},g)}if(p){var _=void 0;return _=m?r()({},o,f):r()({data:o},f),i.scopedSlots.default(_)}return h?t("span",[h(o,f)]):void 0},props:{descriptor:{type:Object,required:!0},record:{type:Object,required:!0},field:{type:String,required:!0}}}},dwmJ:function(t,e,n){"use strict";var i=n("MEGF");n.n(i).a},lhuP:function(t,e,n){"use strict";n.d(e,"b",function(){return o}),n.d(e,"c",function(){return a}),n.d(e,"a",function(){return l});var i=n("JEAp"),r=n.n(i);Object.prototype.toString;function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"value";return t.reduce(function(t,i){return t[i[n]]=i[e],t},{})}function a(t){console&&console.log&&console.log(t)}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"template",n=arguments[2];t instanceof Blob||("string"==typeof t&&(t=[t]),t=new Blob(t,n)),r.a.saveAs(t,e)}}}]);
//# sourceMappingURL=97.6ee4cfa1d760b87edd10.js.map